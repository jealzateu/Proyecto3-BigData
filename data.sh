#!/bin/bash
wget -qO- https://www.datos.gov.co/api/views/gt2j-8ykr/rows.csv?accessType=DOWNLOAD | aws s3 cp - s3://proyecto-big-data-jsj/datos/"`date +"%d-%m"`".csv
aws emr create-cluster --applications Name=Hadoop Name=Hive Name=Hue Name=Spark Name=Sqoop Name=Oozie --ec2-attributes '{"KeyName":"Proyecto","InstanceProfile":"EMR_EC2_DefaultRole","SubnetId":"subnet-66d27200","EmrManagedSlaveSecurityGroup":"sg-0ab6b0368683a3104","EmrManagedMasterSecurityGroup":"sg-0f40b62b45c07e838"}' --release-label emr-5.26.0 --log-uri 's3n://labsmolin19/' --steps '[{"Args":["s3://proyecto-big-data-jsj/s3.sh"],"Type":"CUSTOM_JAR","ActionOnFailure":"CONTINUE","Jar":"s3://us-east-1.elasticmapreduce/libs/script-runner/script-runner.jar","Properties":"","Name":"Custom JAR"}]' --instance-groups '[{"InstanceCount":1,"EbsConfiguration":{"EbsBlockDeviceConfigs":[{"VolumeSpecification":{"SizeInGB":32,"VolumeType":"gp2"},"VolumesPerInstance":2}]},"InstanceGroupType":"MASTER","InstanceType":"m5.xlarge","Name":"Maestro - 1"},{"InstanceCount":2,"EbsConfiguration":{"EbsBlockDeviceConfigs":[{"VolumeSpecification":{"SizeInGB":32,"VolumeType":"gp2"},"VolumesPerInstance":2}]},"InstanceGroupType":"CORE","InstanceType":"m5.xlarge","Name":"Principal - 2"}]' --configurations '[{"Classification":"spark-env","Properties":{},"Configurations":[{"Classification":"export","Properties":{"PYSPARK_PYTHON":"python3"}}]}]' --auto-terminate --auto-scaling-role EMR_AutoScaling_DefaultRole --bootstrap-actions '[{"Path":"s3://proyecto-big-data-jsj/bootstrap.sh","Name":"Custom action"}]' --ebs-root-volume-size 10 --service-role EMR_DefaultRole --enable-debugging --name 'Proyectofinal' --scale-down-behavior TERMINATE_AT_TASK_COMPLETION --region us-east-1
